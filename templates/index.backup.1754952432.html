{% extends "base.html" %}

{% macro img_src(fn) -%}
  {%- if fn and fn.startswith('http') -%}{{ fn }}{%- else -%}{{ url_for('uploaded_file', filename=fn) }}{%- endif -%}
{%- endmacro %}

{% block content %}
  <div style="display:flex;align-items:end;justify-content:space-between;gap:16px;margin-bottom:10px">
    <div>
      <h1 style="font-family:'Playfair Display',serif;margin:0;font-size:2rem">Collectie</h1>
      <div class="meta">Upload items via <a href="/admin">/admin</a>. Kopers kunnen hier bieden.</div>
    </div>
  </div>

  <div class="grid">
    {% for p in products %}
      <div class="card {% if p['is_sold'] %}sold{% endif %}">
        <img
          class="product-image"
          src="{{ img_src(p['image_filename']) if p['image_filename'] else url_for('static', filename='placeholder.png') }}"
          alt="{{ p['title'] }}"
        >
        <div class="pad">
          <div style="display:flex;align-items:center;justify-content:space-between;gap:10px">
            <div style="font-weight:700">{{ p['title'] }}</div>
            {% if p['is_sold'] %}<span class="badge">Verkocht</span>{% endif %}
          </div>
          <div class="meta">Startprijs: €{{ '%.2f'|format(p['price_start']) }}</div>
          <div class="price">Huidig hoogste bod: €{{ '%.2f'|format(highest.get(p['id'], p['price_start']) or p['price_start']) }}</div>
          <div style="margin-top:12px;display:flex;gap:8px">
            <a class="btn primary" href="{{ url_for('product_detail', pid=p['id']) }}">Bekijk & Bied</a>
          </div>
        </div>
      </div>
    {% else %}
      <div class="card">
        <div class="pad">
          <div style="font-weight:700">Nog geen items</div>
          <p class="meta">Log in op de admin om je eerste product te plaatsen.</p>
          <a class="btn" href="/admin">Naar Admin</a>
        </div>
      </div>
    {% endfor %}
  </div>
{% endblock %}
