{% extends "base.html" %}
{% block content %}
  <div class="container">

    <div class="card" style="max-width:720px;margin:0 auto 24px">
      <div class="pad">
        <h2 style="margin:0 0 10px">Nieuw product</h2>
        <form method="post" action="/admin" enctype="multipart/form-data" style="display:grid;gap:12px">
          <input type="hidden" name="action" value="add_product">
          <label>Titel
            <input type="text" name="title" placeholder="Bijv. Vintage stoel" required>
          </label>
          <label>Beschrijving
            <textarea name="description" rows="3" placeholder="Optioneel"></textarea>
          </label>
          <label>Startprijs
            <input type="text" name="price_start" placeholder="Bijv. 95,00" required>
          </label>
          <label>Afbeelding
            <input type="file" name="image" accept="image/*" required>
          </label>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn primary" type="submit">Toevoegen</button>
          </div>
        </form>
      </div>
    </div>

    <h2 style="margin:18px 0">Geplaatste producten</h2>

    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px">
      {% for p in products %}
        <article class="card">
          <img class="product-image" src="{{ img_src(p.image_filename) }}" alt="{{ p.title }}" style="width:100%;height:auto;border-top-left-radius:var(--radius);border-top-right-radius:var(--radius);object-fit:cover;aspect-ratio:4/3">
          <div class="pad">
            <div class="meta" style="display:flex;justify-content:space-between;gap:8px;align-items:center">
              <span>#{{ p.id }}</span>
              {% if p.is_sold %}<span style="font-weight:600;color:#b91c1c">VERKOCHT</span>{% else %}<span>Actief</span>{% endif %}
            </div>
            <h3 style="margin:8px 0 10px">{{ p.title }}</h3>
            <div class="meta">Startprijs: €{{ '%.2f'|format(p.price_start) }}</div>

            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:12px">
              <a class="btn" href="/product/{{ p.id }}">Bekijk</a>
              <a class="btn primary" href="/admin/edit/{{ p.id }}">Bewerken</a>

              <form method="post" action="/admin/mark_sold/{{ p.id }}" onsubmit="return confirm('Markeer dit product als verkocht?');" style="margin:0">
                <button class="btn" type="submit">Markeer verkocht</button>
              </form>

              <form method="post" action="/admin/delete/{{ p.id }}" onsubmit="return confirm('Verwijder product, biedingen en foto’s?');" style="margin:0">
                <button class="btn" type="submit">Verwijderen</button>
              </form>
            </div>
          </div>
        </article>
      {% endfor %}
    </div>

  </div>
{% endblock %}
